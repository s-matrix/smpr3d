---

title: Sparse data structures


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/06_sparse_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_sparse_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Metadata4D" class="doc_header"><code>class</code> <code>Metadata4D</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/core.py#L22" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Metadata4D</code>(<strong><code>E_ev</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_CoM" class="doc_header"><code>get_CoM</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/core.py#L77" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_CoM</code>(<strong><code>ar</code></strong>)</p>
</blockquote>
<p>Finds and returns the center of mass of array ar.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_probe_size" class="doc_header"><code>get_probe_size</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/core.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_probe_size</code>(<strong><code>DP</code></strong>, <strong><code>thresh_lower</code></strong>=<em><code>0.01</code></em>, <strong><code>thresh_upper</code></strong>=<em><code>0.99</code></em>, <strong><code>N</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Gets the center and radius of the probe in the diffraction plane.</p>
<p>The algorithm is as follows:
First, create a series of N binary masks, by thresholding the diffraction pattern DP with a
linspace of N thresholds from thresh_lower to thresh_upper, measured relative to the maximum
intensity in DP.
Using the area of each binary mask, calculate the radius r of a circular probe.
Because the central disk is typically very intense relative to the rest of the DP, r should
change very little over a wide range of intermediate values of the threshold. The range in which
r is trustworthy is found by taking the derivative of r(thresh) and finding identifying where it
is small.  The radius is taken to be the mean of these r values.
Using the threshold corresponding to this r, a mask is created and the CoM of the DP times this
mask it taken.  This is taken to be the origin x0,y0.</p>
<p>Accepts:
    DP              (2D array) the diffraction pattern in which to find the central disk.
                    A position averaged, or shift-corrected and averaged, DP work well.
    thresh_lower    (float, 0 to 1) the lower limit of threshold values
    thresh_upper    (float, 0 to 1) the upper limit of threshold values
    N               (int) the number of thresholds / masks to use</p>
<p>Returns:
    r               (float) the central disk radius, in pixels
    x0              (float) the x position of the central disk center
    y0              (float) the y position of the central disk center</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Sparse4DData" class="doc_header"><code>class</code> <code>Sparse4DData</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/core.py#L139" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Sparse4DData</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

