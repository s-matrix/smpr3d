---

title: Utils for setup


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/20_setup.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/20_setup.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="setup_logging" class="doc_header"><code>setup_logging</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L10" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>setup_logging</code>(<strong><code>path</code></strong>, <strong><code>log_filename</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="configure_node" class="doc_header"><code>configure_node</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>configure_node</code>(<strong><code>dist_backend</code></strong>, <strong><code>init_method</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_smatrix_data_list2" class="doc_header"><code>load_smatrix_data_list2</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_smatrix_data_list2</code>(<strong><code>fn</code></strong>, <strong><code>device</code></strong>, <strong><code>rank</code></strong>, <strong><code>world_size</code></strong>, <strong><code>fftshift_data</code></strong>=<em><code>False</code></em>, <strong><code>subset</code></strong>=<em><code>None</code></em>, <strong><code>r_max</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Load S-matrix reconstruction data. Required hdf5 keys:</p>
<p>Abbreviations:
D: number of scans/ aperture functions
K: number of scan positions
MY/MX: detector shape
NY/NX: S-matrix shape</p>
<p>lambda:                         electron wavelength in Angstrom                 scalar float
alpha_rad:                      convergence angle in radians                    scalar float
C:                              aberration coefficients                         (12, D) float
k_max:                          real-space Nyquist resolution (half-period)     (2,) float
specimen_thickness_angstrom:    appoximate thickness in Angstrom                scalar float
vacuum_probe:                   an image of the vacuum beam                     (MY, MX) float
data:                           diffraction data, fft_shifted                   (D, K, MY, MX) float or integer
r:                              real-space positions, in pixel coordinates      (D, K, 2) float
probe_fourier:                  initial aperture functions                      (D, MY, MX) complex</p>
<p>Optional hdf5 keys:</p>
<p>relative_shifts:                relative shifts of the positions for different aberrations  (D, 2) float
S_target                        target S-matrix from simulation                             (B, NY, NX) complex
Psi_target                      target aperture functions from simulation                   (D, MY, MX) complex
r_target                        target positions from simulation, in pixel coordinates      (D, K, 2) float</p>
<p>:param fn: file name. Must be a valid hdf5 file
:param device: target device for all data
:param rank: rank of the loading process
:param world_size: world_size of the current program
:return: all needed data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="initial_probe_amplitude" class="doc_header"><code>initial_probe_amplitude</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L287" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>initial_probe_amplitude</code>(<strong><code>vacuum_probe</code></strong>, <strong><code>I_target</code></strong>, <strong><code>world_size</code></strong>, <strong><code>rank</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prepare_beam_parameters" class="doc_header"><code>prepare_beam_parameters</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L322" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prepare_beam_parameters</code>(<strong><code>take_beams</code></strong>, <strong><code>q2</code></strong>, <strong><code>specimen_thickness_angstrom</code></strong>, <strong><code>alpha_rad</code></strong>, <strong><code>lam</code></strong>, <strong><code>max_phase_error</code></strong>, <strong><code>use_full_smatrix</code></strong>, <strong><code>device</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="initial_smatrix" class="doc_header"><code>initial_smatrix</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L349" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>initial_smatrix</code>(<strong><code>shape</code></strong>, <strong><code>q_space_tiling</code></strong>, <strong><code>device</code></strong>, <strong><code>is_unitary</code></strong>, <strong><code>include_plane_waves</code></strong>, <strong><code>initial_depth</code></strong>=<em><code>0</code></em>, <strong><code>lam</code></strong>=<em><code>0</code></em>, <strong><code>q2</code></strong>=<em><code>0</code></em>, <strong><code>dtype</code></strong>=<em><code>torch.complex64</code></em>, <strong><code>is_pinned</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>:param shape:               (4-tuple) shape of the S-matrix
:param q_space_tiling:      (2D)
:param device:              torch.device
:param is_unitary:          bool, if the S-matrix should be unitary
:param include_plane_waves: bool, if the S-matrix should be in the plane-wave basis
:param initial_depth:       float, z-depth of the initial S-matrix in Angstrom, gives quadratic phase offset to beams
:param lam:                 float, wavelength in Angstrom
:param q2:                  2D, wavevector squared
:param dtype:               th.dtype
:param is_pinned:           bool, create pinned memory for CPU
:return: initialized S-matrix</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="report_smatrix_parameters" class="doc_header"><code>report_smatrix_parameters</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L401" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>report_smatrix_parameters</code>(<strong><code>rank</code></strong>, <strong><code>world_size</code></strong>, <strong><code>a</code></strong>, <strong><code>S</code></strong>, <strong><code>B</code></strong>, <strong><code>D</code></strong>, <strong><code>K</code></strong>, <strong><code>MY</code></strong>, <strong><code>MX</code></strong>, <strong><code>NY</code></strong>, <strong><code>NX</code></strong>, <strong><code>fy</code></strong>, <strong><code>fx</code></strong>, <strong><code>B_tile</code></strong>, <strong><code>K_rank</code></strong>, <strong><code>specimen_thickness_angstrom</code></strong>, <strong><code>depth_init</code></strong>, <strong><code>y_max</code></strong>, <strong><code>x_max</code></strong>, <strong><code>y_min</code></strong>, <strong><code>x_min</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="report_initial_probes" class="doc_header"><code>report_initial_probes</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/setup.py#L439" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>report_initial_probes</code>(<strong><code>rank</code></strong>, <strong><code>world_size</code></strong>, <strong><code>Psi_gen</code></strong>, <strong><code>C</code></strong>, <strong><code>A_init</code></strong>, <strong><code>specimen_thickness_angstrom</code></strong>, <strong><code>q</code></strong>, <strong><code>lam</code></strong>, <strong><code>alpha_rad</code></strong>, <strong><code>summary</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

