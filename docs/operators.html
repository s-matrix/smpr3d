---

title: Operators


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/30_operators.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/30_operators.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;torch.autograd.anomaly_mode.set_detect_anomaly at 0x7f171a5e1160&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_psi" class="doc_header"><code>calc_psi</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_psi</code>(<strong><code>r</code></strong>, <strong><code>t</code></strong>, <strong><code>z</code></strong>, <strong><code>out</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="r2c" class="doc_header"><code>r2c</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>r2c</code>(<strong><code>real_tensor</code></strong>)</p>
</blockquote>
<p>Convert from real to complex</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ComplexAbs" class="doc_header"><code>class</code> <code>ComplexAbs</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L33" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ComplexAbs</code>() :: <code>Function</code></p>
</blockquote>
<p>Absolute value class for autograd</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BinObject" class="doc_header"><code>class</code> <code>BinObject</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L48" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BinObject</code>() :: <code>Function</code></p>
</blockquote>
<p>Class that bins the object along the direction of beam propagation (z)
inputs:
obj_in: input object
factor: factor at which the object will be binned</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AtF2" class="doc_header"><code>AtF2</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AtF2</code>(<strong><code>z</code></strong>, <strong><code>psi</code></strong>, <strong><code>r</code></strong>, <strong><code>out</code></strong>)</p>
</blockquote>
<p>:param z:   K x MY x MX
:param psi: B x K x MY x MX
:param r:   K x 2
:param out: B x NY x NX
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dS" class="doc_header"><code>dS</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dS</code>(<strong><code>z</code></strong>, <strong><code>z_old</code></strong>, <strong><code>psi</code></strong>, <strong><code>psi_int</code></strong>, <strong><code>psi_int_max</code></strong>, <strong><code>r</code></strong>, <strong><code>out</code></strong>, <strong><code>alpha</code></strong>=<em><code>0.1</code></em>)</p>
</blockquote>
<p>:param z:           K x MY x MX
:param z_old:       K x MY x MX
:param psi:         B x K x MY x MX
:param psi_int:     B x K x MY x MX
:param psi_int_max: B x K
:param r:           K x 2
:param out:         B x NY x NX
:param alpha:       float
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="A_realspace" class="doc_header"><code>A_realspace</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>A_realspace</code>(<strong><code>r</code></strong>, <strong><code>t</code></strong>, <strong><code>psi</code></strong>, <strong><code>out</code></strong>)</p>
</blockquote>
<p>:param r:   K x 2
:param t:   BB x NY x NX
:param psi: B x K x MY x MX
:param out: K x MY x MX
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_psi_denom" class="doc_header"><code>calc_psi_denom</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_psi_denom</code>(<strong><code>r</code></strong>, <strong><code>t</code></strong>, <strong><code>out</code></strong>)</p>
</blockquote>
<p>:param r: K x 2
:param t: BB x NY x NX
:param out: BB x MY x MX
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Qoverlap_real2" class="doc_header"><code>Qoverlap_real2</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Qoverlap_real2</code>(<strong><code>r</code></strong>, <strong><code>z</code></strong>, <strong><code>out</code></strong>)</p>
</blockquote>
<p>:param r: K x 2
:param z: BB x K x MY x MX
:param out: BB x NY x NX
:return: out</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split" class="doc_header"><code>split</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L166" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split</code>(<strong><code>S</code></strong>, <strong><code>r</code></strong>, <strong><code>MY</code></strong>, <strong><code>MX</code></strong>)</p>
</blockquote>
<p>:param S:  B x NY x NX
:param r:  K x 2
:param MY: int
:param MX: int
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="A" class="doc_header"><code>A</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L188" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>A</code>(<strong><code>S</code></strong>, <strong><code>Psi</code></strong>, <strong><code>r</code></strong>, <strong><code>r_min</code></strong>, <strong><code>out</code></strong>=<em><code>None</code></em>, <strong><code>Mx</code></strong>=<em><code>0</code></em>, <strong><code>My</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Fastest version, takes precomputed phase factors, assumes S-matrix with beam tilt included</p>
<p>:param S:               B x NY x NX
:param phase_factors:   B x D x K x 2
:param r:               D x K x 2
:param out:             D x K x MY x MX
:return: exit waves in out</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ScriptFunction object at 0x7f171a5dbef0>" class="doc_header"><code>ScriptFunction object at 0x7f171a5dbef0></code><a href="" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ScriptFunction object at 0x7f171a5dbef0></code>()</p>
</blockquote>
<p>Complex matrix multiplication of tensors a and b.</p>
<p>Pass conjugate = True to conjugate tensor b in the multiplication.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="A_fast_full2" class="doc_header"><code>A_fast_full2</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L224" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>A_fast_full2</code>(<strong><code>S</code></strong>, <strong><code>phase_factors</code></strong>, <strong><code>r</code></strong>, <strong><code>r_min</code></strong>, <strong><code>MY</code></strong>, <strong><code>MX</code></strong>)</p>
</blockquote>
<p>Fastest version, takes precomputed phase factors, assumes S-matrix with beam tilt included</p>
<p>:param S:               B x NY x NX
:param phase_factors:   K x B x 2
:param r:               K x 2
:param out:             K x MY x MX x 2
:return: exit waves in out</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="A_fast_full3" class="doc_header"><code>A_fast_full3</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L254" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>A_fast_full3</code>(<strong><code>S</code></strong>, <strong><code>phase_factors</code></strong>, <strong><code>r</code></strong>, <strong><code>r_min</code></strong>, <strong><code>MY</code></strong>, <strong><code>MX</code></strong>)</p>
</blockquote>
<p>Fastest version, takes precomputed phase factors, assumes S-matrix with beam tilt included</p>
<p>:param S:               B x NY x NX
:param phase_factors:   K x B
:param r:               K x 2
:param out:             K x MY x MX
:return: exit waves in out</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="A_fast_full5" class="doc_header"><code>A_fast_full5</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L295" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>A_fast_full5</code>(<strong><code>S</code></strong>, <strong><code>phase_factors</code></strong>, <strong><code>r</code></strong>, <strong><code>r_min</code></strong>, <strong><code>MY</code></strong>, <strong><code>MX</code></strong>)</p>
</blockquote>
<p>Fastest version, takes precomputed phase factors, assumes S-matrix with beam tilt included</p>
<p>:param S:               B x NY x NX
:param phase_factors:   K x B
:param r:               K x 2
:param out:             K x MY x MX
:return: exit waves in out</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="A_fast_full4" class="doc_header"><code>A_fast_full4</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L335" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>A_fast_full4</code>(<strong><code>S</code></strong>, <strong><code>phase_factors</code></strong>, <strong><code>r</code></strong>, <strong><code>r_min</code></strong>, <strong><code>out</code></strong>=<em><code>None</code></em>, <strong><code>Mx</code></strong>=<em><code>0</code></em>, <strong><code>My</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Fastest version, takes precomputed phase factors, assumes S-matrix with beam tilt included</p>
<p>:param S:               B x NY x NX
:param phase_factors:   B x D x K x 2
:param r:               D x K x 2
:param out:             D x K x MY x MX
:return: exit waves in out</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AH_S" class="doc_header"><code>AH_S</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L364" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AH_S</code>(<strong><code>z</code></strong>, <strong><code>Psi</code></strong>, <strong><code>r</code></strong>, <strong><code>r_min</code></strong>, <strong><code>out</code></strong>=<em><code>None</code></em>, <strong><code>tau</code></strong>=<em><code>tensor([1.])</code></em>, <strong><code>Ny</code></strong>=<em><code>-1</code></em>, <strong><code>Nx</code></strong>=<em><code>-1</code></em>)</p>
</blockquote>
<p>Adjoint S-matrix operator for the full S-matrix. Expects pre-computed phase-factors as inputs.</p>
<p>:param z:               D x K x My x Mx
:param Psi:             D x My x Mx
:param r:               D x K x 2
:param r_min:           2
:param out:             B x NY x NX x 2
:param Ny:              optional, int
:param Nx:              optional, int
:return: result of adjoint S-matrix operator, shape (B x NY x NX x 2)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="smatrix_phase_factorsBDK" class="doc_header"><code>smatrix_phase_factorsBDK</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L405" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>smatrix_phase_factorsBDK</code>(<strong><code>Psi</code></strong>, <strong><code>r</code></strong>, <strong><code>take_beams</code></strong>, <strong><code>q</code></strong>, <strong><code>B</code></strong>, <strong><code>out</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Abbreviations:
B: number of (input) beams in S-matrix
D: number of scans/ aperture functions
K: number of scan positions
MY/MX: detector shape
NY/NX: S-matrix shape</p>
<p>:param Psi: q           D x B
:param r:               D x K x 2
:param take_beams:      MY x MX
:param q:               2 x MY x MX
:param out:             B x D x K x 2
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="smatrix_phase_factorsKB" class="doc_header"><code>smatrix_phase_factorsKB</code><a href="https://github.com/s-matrix/smpr3d/tree/master/smpr3d/operators.py#L441" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>smatrix_phase_factorsKB</code>(<strong><code>Psi</code></strong>, <strong><code>r</code></strong>, <strong><code>take_beams</code></strong>, <strong><code>q</code></strong>, <strong><code>q_indices</code></strong>, <strong><code>B</code></strong>, <strong><code>out</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Abbreviations:
B: number of (input) beams in S-matrix
K: number of scan positions
MY/MX: detector shape
NY/NX: S-matrix shape</p>
<p>:param Psi: q           MY x MX
:param r:               K x 2
:param take_beams:      MY x MX
:param q:               2 x MY x MX
:param q_indices:       2 x MY x MX
:param out:             K x B x 2
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

